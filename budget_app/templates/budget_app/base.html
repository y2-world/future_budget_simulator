<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{% block title %}家計シミュレーター{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Toastify CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <style>
        /* トーストの閉じるボタンのスタイル調整 */
        .toastify-close {
            opacity: 0.8;
            font-size: 18px !important;
            font-weight: 300 !important;
            line-height: 1 !important;
        }
        .toastify-close:hover {
            opacity: 1;
        }
        /* 閉じるアイコンを別のものに変更 */
        .toastify-close::before {
            content: "✕" !important;
            font-size: 20px;
            display: inline-block;
        }
        .toastify-close {
            text-indent: -9999px;
            position: relative;
        }
        .toastify-close::before {
            text-indent: 0;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        /* アンカーリンク用のスクロールマージン（ヘッダー分のオフセット） */
        [id] {
            scroll-margin-top: 120px; /* モバイル: ヘッダー高さ + 余白 */
        }

        /* デスクトップ用 (1024px以上) */
        @media (min-width: 1024px) {
            [id] {
                scroll-margin-top: 120px; /* デスクトップ: ヘッダー高さ + 余白 */
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <nav class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-xl sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <h1 class="text-xl md:text-2xl font-bold">
                    <a href="{% url 'budget_app:index' %}" class="hover:opacity-90 transition flex items-center">
                        <span class="bg-white text-blue-600 rounded-lg px-2 py-1 mr-2 text-sm md:text-base flex items-center justify-center">
                            <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </span>
                        家計シミュレーター
                    </a>
                </h1>

                <!-- デスクトップメニュー -->
                <div class="hidden lg:flex space-x-4">
                    <a href="{% url 'budget_app:index' %}" class="hover:bg-white/10 px-3 py-2 rounded-lg transition">月次計画</a>
                    <a href="{% url 'budget_app:past_transactions' %}" class="hover:bg-white/10 px-3 py-2 rounded-lg transition">過去の明細</a>
                    <a href="{% url 'budget_app:credit_estimates' %}" class="hover:bg-white/10 px-3 py-2 rounded-lg transition">クレカ見積</a>
                    <a href="{% url 'budget_app:credit_defaults' %}" class="hover:bg-white/10 px-3 py-2 rounded-lg transition">定期項目</a>
                    <a href="{% url 'budget_app:salary_list' %}" class="hover:bg-white/10 px-3 py-2 rounded-lg transition">給与一覧</a>
                    <a href="{% url 'budget_app:config' %}" class="hover:bg-white/10 px-3 py-2 rounded-lg transition">設定</a>
                </div>

                <!-- モバイルメニューボタン -->
                <button id="mobile-menu-button" class="lg:hidden p-2 rounded-lg hover:bg-white/10 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>

            <!-- モバイルメニュー -->
            <div id="mobile-menu" class="hidden lg:hidden mt-4 pb-2 space-y-2">
                <a href="{% url 'budget_app:index' %}" class="block hover:bg-white/10 px-4 py-2 rounded-lg transition">月次計画</a>
                <a href="{% url 'budget_app:past_transactions' %}" class="block hover:bg-white/10 px-4 py-2 rounded-lg transition">過去の明細</a>
                <a href="{% url 'budget_app:credit_estimates' %}" class="block hover:bg-white/10 px-4 py-2 rounded-lg transition">クレカ見積</a>
                <a href="{% url 'budget_app:credit_defaults' %}" class="block hover:bg-white/10 px-4 py-2 rounded-lg transition">定期項目</a>
                <a href="{% url 'budget_app:salary_list' %}" class="block hover:bg-white/10 px-4 py-2 rounded-lg transition">給与一覧</a>
                <a href="{% url 'budget_app:config' %}" class="block hover:bg-white/10 px-4 py-2 rounded-lg transition">設定</a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto {% block main_padding %}px-4 py-8{% endblock %}">
        {% block content %}{% endblock %}
    </main>

    <footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white py-6 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <p class="text-sm text-gray-400">&copy; 2025 家計シミュレーター</p>
                <p class="text-xs text-gray-500 mt-2 md:mt-0">未来の家計を賢く管理</p>
            </div>
        </div>
    </footer>

    <!-- Toastify JS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- 共通ユーティリティ関数 -->
    {% load static %}
    <script type="text/javascript" src="{% static 'budget_app/js/common.js' %}?v={% now "U" %}"></script>

    <script>
        // ========================================
        // モバイルメニュートグル
        // ========================================
        document.getElementById('mobile-menu-button')?.addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        });

        // ========================================
        // ページ読み込み時のアンカースクロール処理
        // ========================================

        // アンカーへスクロールする共通関数
        function scrollToAnchorWithOffset(anchorId) {
            const targetElement = document.querySelector(anchorId);
            if (targetElement) {
                // ヘッダーの高さを取得
                const header = document.querySelector('nav');
                const headerHeight = header ? header.offsetHeight : 0;

                // 要素の位置を取得してヘッダー分を引く
                const elementPosition = targetElement.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerHeight - 40; // 40pxの余白を追加

                // スムーズスクロール
                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
        }

        // ページ読み込み時の処理
        window.addEventListener('load', function() {
            // sessionStorageからアンカーを取得（トーストクリック時に保存される）
            let scrollToAnchor = sessionStorage.getItem('scrollToAnchor');

            if (scrollToAnchor) {
                // sessionStorageをクリア
                sessionStorage.removeItem('scrollToAnchor');

                // 少し遅延させて要素が確実にレンダリングされるのを待つ
                setTimeout(function() {
                    scrollToAnchorWithOffset(scrollToAnchor);
                }, 100);
            }
        });

        // URLのハッシュが変更された時の処理（同一ページ内でのアンカーリンク移動）
        window.addEventListener('hashchange', function() {
            if (window.location.hash) {
                // ブラウザのデフォルトスクロールを防ぐため少し遅延
                setTimeout(function() {
                    scrollToAnchorWithOffset(window.location.hash);
                }, 10);
            }
        });
    </script>
</body>
</html>
